#	$NetBSD: Makefile.xf86-driver,v 1.7 2008/08/10 10:26:10 rtr Exp $

LIBISMODULE=	yes

.include <bsd.own.mk>
.include <bsd.x11.mk>

LIB=	${DRIVER_NAME}

PRINT_PACKAGE_VERSION=	awk '/^PACKAGE_VERSION=/ {			\
				match($$1, "[0-9]+\\.[0-9]+\\.[0-9]+");	\
				version = substr($$1, RSTART, RLENGTH);	\
			} END { print version }'			\
			${X11SRCDIR.${DRIVER}}/configure

PACKAGE_VERSION!=	${PRINT_PACKAGE_VERSION}

PRINT_PACKAGE_MAJOR=	echo ${PACKAGE_VERSION} | awk -F. '{	\
				major = $$1;			\
			} END { print major }'
PACKAGE_MAJOR!=		${PRINT_PACKAGE_MAJOR}

PRINT_PACKAGE_MINOR=	echo ${PACKAGE_VERSION} | awk -F. '{	\
				minor = $$2;			\
			} END { print minor }'
PACKAGE_MINOR!=		${PRINT_PACKAGE_MINOR}

PRINT_PACKAGE_PATCH=	echo ${PACKAGE_VERSION} | awk -F. '{	\
				patch = $$3;			\
			} END { print patch }'
PACKAGE_PATCH!=		${PRINT_PACKAGE_PATCH}

CPPFLAGS+=	-I${DESTDIR}${X11INCDIR}/xorg \
		-I${DESTDIR}${X11INCDIR}/pixman-1 \
		-I${X11SRCDIR.xorg-server}/../include \
		${X11FLAGS.DIX} ${X11INCS.DIX} \
		-DXFree86LOADER

CPPFLAGS+=	-DPACKAGE_VERSION_MAJOR=${PACKAGE_MAJOR}
CPPFLAGS+=	-DPACKAGE_VERSION_MINOR=${PACKAGE_MINOR}
CPPFLAGS+=	-DPACKAGE_VERSION_PATCHLEVEL=${PACKAGE_PATCH}
CPPFLAGS+=	-DXORG_VERSION_CURRENT=${XORG_VERSION_CURRENT}

.PATH:	${X11SRCDIR.${DRIVER}}/src
.PATH:	${X11SRCDIR.${DRIVER}}/man

LIBDIR?=	${X11USRLIBDIR}/modules/drivers

.include <bsd.lib.mk>
