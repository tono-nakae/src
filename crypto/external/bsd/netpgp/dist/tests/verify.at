# $NetBSD: verify.at,v 1.3 2009/05/27 07:00:32 lukem Exp $

AT_SETUP([check-verify])

cp ${TOPSRCDIR}/configure file1

# Sign the file
# XXX: this prompts for a passphrase when the userid doesn't have one
AT_CHECK([$NETPGP --homedir $testhomedir --sign file1],
    [0], [ignore], [ignore])

# Verify the signed file
AT_CHECK([$NETPGP --homedir $testhomedir --verify file1.gpg],
    [0], [ignore], [ignore])

# Fail to verify an unsigned file
# XXX: determine how to expand $testuserid instead of hard-coding
AT_CHECK([$NETPGP --homedir $testhomedir --verify file1],
    [1], [ignore],
[netpgp: default key set to "C7AB5F325F918728"
"file1": No signatures found - is this a signed file?
])

# XXXTODO: deliberately corrupt file1.gpg and attempt to verify


AT_CLEANUP
