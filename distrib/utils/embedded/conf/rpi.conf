# $NetBSD: rpi.conf,v 1.9 2013/01/16 23:27:34 christos Exp $
# Raspberry PI customization script used by mkimage
#

board=rpi
kernelconf=RPI
kerneldir=$src/sys/arch/evbarm/compile/${kernelconf}

. ${DIR}/conf/evbarm.conf

firmwaredir=$src/external/broadcom/rpi-firmware/dist
firmwarefiles="LICENCE.broadcom bootcode.bin fixup.dat fixup_cd.dat start.elf start_cd.elf"

make_filesystems() {
	make_filesystems_evbarm
}

make_fstab() {
	make_fstab_evbarm
}

customize() {
	customize_evbarm
	${sudo} cat >> ${mnt}/etc/rc.conf << EOF
wscons=YES
EOF

	${sudo} cat > ${mnt}/boot/cmdline.txt << EOF
console=fb
#fb=1280x1024		# to select a mode, otherwise EDID will be tried and fallback to
#fb=disable		# to disable fb completely
EOF

	echo -n "${bar} installing firmware files:"
	(cd ${mnt}/boot &&
		for f in ${firmwarefiles}; do
			echo -n " $f"
			${sudo} cp ${firmwaredir}/${f} .
		done
	)
	echo " ${bar}"

}

cleanup() {
	cleanup_evbarm
}
