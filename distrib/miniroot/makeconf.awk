#	$NetBSD: makeconf.awk,v 1.1 1995/12/18 22:47:31 pk Exp $

BEGIN {
	# a list of `aliases'
	links["chgrp",0] = "chown";
	links["awk",0] = "gawk";
	links["gzcat",0] = "gzip";
	links["gunzip",0] = "gzip";
	links["-sh",0] = "sh";		# init invokes the shell this way
	links["[",0] = "test";
	links["cd9660",0] = "mount_cd9660";
	links["ffs",0] = "mount_ffs";
	links["nfs",0] = "mount_nfs";
	links["halt",0] = "reboot";
	links["vi",0] = "common";	# XXX catch vi
}

($1 == "LINK" || $1 == "SYMLINK") && index($2,CBIN) {
	n = split($3, x, "/");
	p = x[n];
	if ((p,0) in links) {
		links[p,1] = links[p,0];
		p = links[p,0];
	}
	if (p == "sh")			# XXX - catch `-sh'
		links["-sh",1] = "sh";
	progs[p] = 1;
}

END {
	# write crunchgen configuration

	printf("#\n# This file is automatically generated by `makeconf'\n#\n");
	printf("srcdirs bin sbin usr.bin usr.sbin gnu/usr.bin usr.bin/vi\n");

	i = 0;
	for (p in progs) {
		if ((i++ % 8) == 0)
			printf("\nprogs");
		printf(" %s", p);
	}
	printf("\n\n");

	for (I in links) {
		split(I, l, SUBSEP);
		if (l[2])
			printf("ln %s %s\n", links[l[1],1], l[1]);
	}

	printf("\nlibs -ledit -lutil -lcurses -ltermcap -lcrypt -ll -lm -lkvm\n");
}
