#!/bin/sh
#
# $NetBSD: mountcritlocal,v 1.6 2002/03/27 08:53:42 lukem Exp $
#

# PROVIDE: mountcritlocal
# REQUIRE: root

. /etc/rc.subr

name="mountcritlocal"
start_cmd="mountcritlocal_start"
stop_cmd=":"

mountcritlocal_start()
{
	#	If obsolete $critical_filesystems_beforenet is set,
	#	use that instead of $critical_filesystems_local.
	#
	if [ -n "$critical_filesystems_beforenet" -o \
	    "${critical_filesystems_beforenet-unset}" != "unset" ]; then
		warn 'Overriding $critical_filesystems_local with obsolete $critical_filesystems_beforenet'
		critical_filesystems_local=$critical_filesystems_beforenet
	fi

	#	Mount critical filesystems that are `local'
	#	(as specified in $critical_filesystems_local)
	#	This usually includes /var.
	#
	mount_critical_filesystems local

	#	clean up left-over files.
	#	this could include the cleanup of lock files and /var/run, etc.
	#
	rm -f /etc/nologin /var/spool/lock/LCK.* /var/spool/uucp/STST/*
	(cd /var/run && rm -rf -- *)
}

load_rc_config $name
run_rc_command "$1"
