#!/bin/sh
#
# $NetBSD: syslogd,v 1.8 2001/03/12 16:04:20 lukem Exp $
#

# PROVIDE: syslogd
# REQUIRE: mountcritremote sysdb wscons

. /etc/rc.subr

name="syslogd"
rcvar=$name
command="/usr/sbin/${name}"
pidfile="/var/run/${name}.pid"
required_files="/etc/syslog.conf"
start_precmd="syslogd_precmd"
extra_commands="reload"

syslogd_precmd()
{
	#	Transitional symlink for old binaries
	#
	if [ ! -h /dev/log ]; then
		ln -sf /var/run/log /dev/log
	fi

	#	If running named(8) chrooted, added syslogd socket for it,
	#	by changing run_rc_command()'s internal copy of $syslogd_flags.
	#
	rm -f /var/run/log
	if checkyesno named && [ -n "$named_chrootdir" ]; then
		rm -f ${named_chrootdir}/var/run/log
		_flags="-p /var/run/log -p ${named_chrootdir}/var/run/log $_flags"
	fi

	return 0
}

load_rc_config $name
run_rc_command "$1"
